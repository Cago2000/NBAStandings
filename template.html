<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NBA Standings vs Predictions</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #111;
    color: #eee;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #fff;
    background-color: #f39c12;
    display: inline-block;
    padding: 15px 30px;
    border-radius: 10px;
    margin-bottom: 30px;
  }
  .header-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
    font-size: 1.5em;
    color: gold;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  .standings {
    background-color: #222;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
  }
  .standings h2 {
    text-align: center;
    color: #1abc9c;
    margin-bottom: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 5px;
    text-align: center;
    border-bottom: 1px solid #333;
  }
  th {
    background-color: #333;
    color: #fff;
  }
  td.win { color: #27ae60; font-weight: bold; }
  td.loss { color: #e74c3c; font-weight: bold; }
  tr.match { background-color: #27ae60; color: #fff; font-weight: bold; }
  tr.almost-match { background-color: #f1c40f; color: #000; font-weight: bold; }
  tr:hover { background-color: #444; }
</style>
</head>
<body>

<h1>NBA Standings vs Predictions</h1>

<div class="header-row">
  <div>Truth</div>
  <div id="can-header">Can</div>
  <div id="marlon-header">Marlon</div>
  <div id="ole-header">Ole</div>
</div>

<div class="grid">
  <!-- WEST ROW -->
  <div class="standings">
    <h2>West</h2>
    <table id="truth-west-table">
      <thead><tr><th>Seed</th><th>Team</th><th>W</th><th>L</th><th>GB</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="standings">
    <h2>West</h2>
    <table id="can-west-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="standings">
    <h2>West</h2>
    <table id="marlon-west-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="standings">
    <h2>West</h2>
    <table id="ole-west-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
  <!-- EAST ROW -->
  <div class="standings">
    <h2>East</h2>
    <table id="truth-east-table">
      <thead><tr><th>Seed</th><th>Team</th><th>W</th><th>L</th><th>GB</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="standings">
    <h2>East</h2>
    <table id="can-east-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="standings">
    <h2>East</h2>
    <table id="marlon-east-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="standings">
    <h2>East</h2>
    <table id="ole-east-table"><thead><tr><th>Seed</th><th>Team</th></tr></thead><tbody></tbody></table>
  </div>
</div>

<script>
async function loadData() {
  try {
    const res = await fetch('/standings.json');
    const data = await res.json();
    const users = ["Can", "Marlon", "Ole"];
    const conferences = ["East", "West"];

    // --- Sort truth by NBA rules: win% descending, then GB ascending ---
    function sortTruthTeams(teams) {
      return teams.slice().sort((a, b) => {
        const winPctA = a.wins / (a.wins + a.losses);
        const winPctB = b.wins / (b.wins + b.losses);
        if (winPctB !== winPctA) return winPctB - winPctA;
        return a.games_behind - b.games_behind; // smaller GB first
      });
    }

    function fillTable(tableId, teams, includeWL=false, truthTeams=[]) {
      const tbody = document.getElementById(tableId).querySelector('tbody');
      tbody.innerHTML = '';
      teams.forEach((team, i) => {
        const tr = document.createElement('tr');
        if (includeWL) {
          tr.innerHTML = `<td>${i+1}</td><td>${team.team}</td><td class="win">${team.wins}</td><td class="loss">${team.losses}</td><td>${team.games_behind}</td>`;
        } else {
          tr.innerHTML = `<td>${team.seed}</td><td>${team.team}</td>`;
          const truthPos = truthTeams.findIndex(t => t.team === team.team);
          if (truthPos === i) tr.classList.add('match');
          else if (Math.abs(truthPos - i) === 1) tr.classList.add('almost-match');
        }
        tbody.appendChild(tr);
      });
    }

    function calculatePoints(predTeams, truthTeams) {
      let points = 0;
      predTeams.forEach((t, i) => {
        const truthPos = truthTeams.findIndex(tr => tr.team === t.team);
        if (truthPos === i) points += 2;
        else if (Math.abs(truthPos - i) === 1) points += 1;
      });
      return points;
    }

    // --- Sort truth per conference ---
    const sortedTruth = {};
    conferences.forEach(conf => {
      sortedTruth[conf] = sortTruthTeams(data[conf]);
      fillTable(`truth-${conf.toLowerCase()}-table`, sortedTruth[conf], true);
    });

    // --- Fill predictions ---
    users.forEach(u => {
      let totalPoints = 0;
      let maxPoints = 0;
      conferences.forEach(conf => {
        const predTeams = data[u][conf] || [];
        const truthTeams = sortedTruth[conf];
        fillTable(`${u.toLowerCase()}-${conf.toLowerCase()}-table`, predTeams, false, truthTeams);
        totalPoints += calculatePoints(predTeams, truthTeams);
        maxPoints += predTeams.length * 2;
      });
      document.getElementById(`${u.toLowerCase()}-header`).textContent = `${u} (${totalPoints}/${maxPoints})`;
    });

  } catch (err) {
    console.error("Failed to load JSON:", err);
  }
}

// Initial load
loadData();
</script>

</body>
</html>

